<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>瘦瘦瘦瘦瘦耶</title>
	<script src="/js/jquery-1.11.3.min.js"></script>
	<script src="/js/jquery.pin.js"></script>
	<link rel="stylesheet" href="/css/Smohan.blog.css">
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<!-- <link rel="stylesheet" href="/css/modern.css"> -->
	<link rel="stylesheet" href="/css/style.css">
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/temp.js"></script>
</head>
<body>
	<%- include header %>
	<div class="container">
		<div id="container">
		  	<div class="timeline_container">
		    	<div class="timeline">
		      		<div class="plus"></div>
		      		<div class="plus2"></div>
		    	</div>
		  	</div>
		  	<%- include test %>
  		</div>
  		<button type="button" class="btn btn-default floatb" style="border-radius:10px;" data-toggle="modal" data-target="#addcomment" data-whatever="">吐槽点我</button>	
  		<div class="modal fade" id="addcomment" tabindex="-1" role="dialog" aria-labelledby="addcomment">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        		<h4 class="modal-title" id="exampleModalLabel">添加评论</h4>
		      		</div>
		     	 	<div class="modal-body">
		        		<form action="/comment" method="post">
						  	<div class="form-group">
						    	<label for="nickname">昵称</label>
						    	<input type="text" class="form-control" name="nickname" id="nickname" placeholder="请输入昵称">
						  	</div>
						  	<div class="form-group">
						   	 	<label for="con">评论内容</label>
						   	 	<textarea class="form-control" name="con" id="con" cols="40" rows="10" placeholder="请输入评论内容"></textarea>
						  	</div>
							<input type="text" name="id" id="id" value="0" hidden>
						</form>	
		      		</div>
		      		<div class="modal-footer">
		      			<button type="button" id="submit" class="btn btn-default">提交评论</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		      		</div>
		    	</div>
		  	</div>
		</div>
	</div>
	<script>
	$(function(){
		$('#container').masonry({itemSelector : '.item'});
		function Arrow_Points(){
	  		var s = $("#container").find(".item");
	 	 	$.each(s,function(i,obj){
				var posLeft = $(obj).css("left");
				if(posLeft == "0px"){
		  		html = "<span class='rightCorner'></span>";
		  		$(obj).prepend(html);
				} else {
		  		html = "<span class='leftCorner'></span>";
		  		$(obj).prepend(html);
				}
	  		});
		}	
		Arrow_Points();
		var page=2;
		$(window).scroll(function(){ 
			// console.log('123'); 
			var count = (page - 1) * 5;
			var total = <%=parseInt(total)%>;
	        var $this =$(this),  
	        viewH =$(this).height(),//可见高度  
	        contentH =$(document).height(),//内容高度  
	        scrollTop =$(this).scrollTop();//滚动高度  
	        //if(contentH - viewH - scrollTop <= 100) { //到达底部100px时,加载新内容  
	        	//console.log(contentH, scrollTop, viewH);
	        if(scrollTop/(contentH -viewH)>=0.95){ //到达底部100px时,加载新内容  
	        	if(count<total){
	        		$.get("/comment/"+page, function(item){
	        			console.log(item);
	        			$("#container").append(item);
	        		}) 
		        	page += 1;
	        	}else{
	        		alert("没有更多内容了");
	        	}
	        	// if(count<total){
	        	// 	window.location.href = "/comment/" +page; 
		        // 	page += 1;
	        	// }else{
	        	// 	alert("没有更多内容了");
	        	// }
		        
	        }  
	    }); 
		$("#submit").click(function(){
			$("form").submit();
		})
		
	})
</script>
	<%- include footer%>
</body>
</html>